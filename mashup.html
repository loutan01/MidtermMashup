<!DOCTYPE html>

<html>
  <head>
    <title> Weather Mashup</title>
    <h1>Weather mashup</h1>
    <script type = "text/javascript">

      weatherFromWolfram = function(region, city){
        var obj2, weather, printWeather
        obj2 = new XMLHttpRequest()
        obj2.open("GET", "/getWeather/"+city+"/"+region, true);
        console.log(obj2)
        obj2.onreadystatechange = function(){
            if(obj2.readyState == 4 && obj2.status == 200){
              weather = document.createTextNode(obj2.responseText);
              node = document.getElementById("fromWolframQuery");
              replacedNode = document.getElementById("fromWolframQuery").childNodes[0];
              node.replaceChild(weather, replacedNode);
            }
        };

        obj2.send()
      }

      weatherOfInput = function(){
        stringOfArea = document.getElementById("area").value;
        area = stringOfArea.split(", ");
        city = area.shift()
        region= area.toString()
        console.log(city)
        console.log(region)

        weatherFromWolfram(region, city)
        imageOfLocation(region, city)

      }

      imageOfLocation = function(region, city){
        var obj3, concatenatedString
        concatenatedString = region + " "+ city
        query = concatenatedString.replace(" ", "%20")
        obj3 = new XMLHttpRequest()
          obj3.onreadystatechange = function(){
            if(obj3.readyState == 4 && obj3.status == 200){
              aVar = obj3.responseXML
              console.log(aVar)
            }
        };
        obj3.open("GET", "https://api.flickr.com/services/rest/?method=flickr.photos.search&api_key=KEY&text=" + query + "&format=rest", true)
        obj3.send()
      }

      weatherByLocation = function(){
        var obj, aVar, splitter, splitter2, region, city
        obj = new XMLHttpRequest()
        obj.onreadystatechange = function(){

          if(obj.readyState == 4 && obj.status == 200){
            aVar = obj.responseXML
            console.log(aVar)
            splitter = aVar.getElementsByTagName("regionName")
            region = splitter[0].childNodes[0].data
            splitter2 = aVar.getElementsByTagName("city")
            city = splitter2[0].childNodes[0].data
            console.log(region)
            console.log(city)
            weatherFromWolfram(region, city)
            imageOfLocation(region, city)
          }

        };

        obj.open("GET", "http://ip-api.com/xml/?fields=regionName,city", true);
        obj.send();
      }

    </script>
  </head>
  <body>

  <div id = "infoIn">

    <input id = "area" type = "text" placeholder = "Enter City and Region separated by a comma" size = "50">

    <button onclick = "weatherOfInput()">Get weather now!</button>

    <button onclick = "weatherByLocation()">Get weather for my Location</button>


  </div>
  <div id = "wolframAlphaOutput">
    <p id = "fromWolframQuery">The weather goes here!</p>
  </div>

  </body>

</html>
